---
title: "Final Project"
author: "Grace Montgomery"
subtitle: MGSC 410 Problem Set Template
output:
  html_document:
    df_print: paged
  html_notebook: default
---

```{r setup, include=FALSE}
library(knitr)

# set seed to your own favorite number
set.seed(1818)
options(width=70)
options(scipen=99)


# general rchunk code options

# this sets text to small
opts_chunk$set(tidy.opts=list(width.wrap=50),tidy=TRUE, size = "vsmall")  
opts_chunk$set(message = FALSE,                                          
               warning = FALSE,
               # "caching" stores objects in code chunks and only rewrites if you change things
               cache = TRUE,                               
               # automatically downloads dependency files
               autodep = TRUE,
               # 
               cache.comments = FALSE,
               # 
               collapse = TRUE,
               fig.width = 5,  
               fig.height = 4,
               fig.align='center')


```

## Loading Libraries

```{r}
rm(list = ls())
```

```{r}
library('magrittr')
library('dplyr')
library('tidyr')
library('tidyverse')
library('ggridges')
library('gganimate')
library('forcats')
library('rsample')
library('glmnet')
library('glmnetUtils')
library('broom')
library('coefplot')
library('cluster')
library('factoextra')
library('NbClust')

```

# More libraries 
```{r}
library(hclust)

```


Loading datasets

```{r}
app_activity <- read.csv(here::here("cleaned_data", "app_activity.csv"))
master_data <- read.csv(here::here("cleaned_data", "master_data.csv"), na.strings = "NULL")
```

Data Manipulation
#changed Purchase.Amount.In.USD to a numeric in excel and replaced the $- to 0
```{r}
master_data <- master_data %>% mutate(
  Purchase.Amount.in.USD = as.numeric(Purchase.Amount.in.USD),
  Langauge = as.factor(Language),
  Subscription.Type = as.factor(Subscription.Type),
  Subscription.Event.Type = as.factor(Subscription.Event.Type),
  Purchase.Store = as.factor(Purchase.Store),
  Currency = as.factor(Currency),
  Demo.User = as.factor(Demo.User),
  Free.Trial.User = as.factor(Free.Trial.User),
  Auto.Renew = as.factor(Auto.Renew),
  Country = as.factor(Country),
  User.Type = as.factor(User.Type),
  Lead.Platform = as.factor(Lead.Platform),
  Email.Subscriber = as.factor(Email.Subscriber),
  Push.Notifications = as.factor(Push.Notifications)
  ) %>% select(-Purchase.Amount)

# change "unknown" in Lead platform to NA
```

#First attempt cluster unsupervised Hierarchical Agglomerative Clustering
Variables: Language, Purchase Amount,Subscription Type, Send count, Open count, Click count, Unique open count, Unique click count

https://www.datacamp.com/community/tutorials/hierarchical-clustering-R
https://uc-r.github.io/hc_clustering

HA cluttering code
```{r}

HA_clust_df <- master_data %>% 
  select(Language, Purchase.Amount.in.USD, Subscription.Type, Send.Count, Open.Count, Click.Count, Unique.Open.Count, Unique.Click.Count) %>% 
  mutate(
    Language = as.factor(Language),
    Subscription.Type = as.factor(Subscription.Type)
  )

#omit NA's
HA_clust_df <- na.omit(HA_clust_df)
HA_clust_df <- scale(HA_clust_df)

```


```{r}
# Dissimilarity Matrix
d <- dist(HA_clust_df, method = "euclidean")
# Hierarchical clustering using complete linkage
hcl <- hclust(d, method = "complete")
#PLot dendrogram
plot(hcl, cex = 0.6, hang = -1)

```


























